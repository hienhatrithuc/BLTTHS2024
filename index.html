
<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tra cứu Bộ luật Tố tụng Hình sự</title>
<style>
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; margin:0; padding-top:100px; background-color:#f5f5f5; }
#search-bar { 
    position: fixed; 
    top: 0; 
    left: 0; 
    width: 100%; 
    background-color: #ffffff; 
    box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
    padding: 10px; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    z-index: 1000; 
    gap: 10px; 
    border-bottom: 2px solid #007aff;
}
#search-bar button, #search-bar input {
    padding: 10px;
    font-size: 18px;
    border: 1px solid #ccc;
    border-radius: 8px;
}
#search-bar button {
    background-color: #007aff;
    color: white;
    cursor: pointer;
}
#search-bar button:hover {
    background-color: #005bb5;
}
#search-box { width: 250px; }
#results { margin: 20px; }
#summary { margin: 10px 20px; font-size: 18px; }
.highlight { background-color:yellow; font-weight:bold; }
.article { background:white; padding:20px; margin-bottom:20px; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.08); text-align:justify; line-height:1.6; }
.article p { text-indent:2em; margin-bottom:10px; }
.article h3 { margin-bottom:15px; }
h2 { color:#007aff; margin-top:30px; }
</style>
</head>
<body>

<div id="search-bar">
    <button id="prev-btn">&lt;</button>
    <button id="next-btn">&gt;</button>
    <button id="top-btn">^</button>
    <input type="text" id="search-box" placeholder="Nhập từ khóa tìm kiếm...">
    <button id="search-btn">Tìm kiếm</button>
</div>

<div id="summary"></div>
<div id="results"></div>

<script>
let articles = [];
let filteredArticles = [];
let searchKeyword = '';
let currentMatchIndex = -1;
let matchElements = [];

fetch('bo_luat_to_tung_hinh_su_full.json')
.then(response => response.json())
.then(data => {
    articles = data;
    displayAllArticles();
});

function highlightKeyword(text, keyword) {
    if (!keyword) return text;
    let regex = new RegExp('(' + keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + ')', 'gi');
    return text.replace(regex, '<span class="highlight">$1</span>');
}

function formatNoiDung(text, keyword) {
    text = text.replace(/(?<!\n)(\d+\.\s)/g, '\n$1');
    text = text.replace(/(?<!\n)([a-z]\))/g, '\n$1');
    const parts = text.trim().split('\n');
    return parts.map(p => `<p>${highlightKeyword(p.trim(), keyword)}</p>`).join('\n');
}

function displayAllArticles() {
    const container = document.getElementById('results');
    container.innerHTML = '';
    let currentChapter = '';
    articles.forEach(article => {
        if (article.chuong !== currentChapter) {
            currentChapter = article.chuong;
            container.innerHTML += `<h2>${currentChapter}</h2>`;
        }
        container.innerHTML += `
        <div class="article">
            <h3>${article.dieu}</h3>
            ${formatNoiDung(article.noi_dung, '')}
        </div>`;
    });
    document.getElementById('summary').innerText = '';
}

function search() {
    const keyword = document.getElementById('search-box').value.trim();
    searchKeyword = keyword;
    if (!keyword) {
        displayAllArticles();
        return;
    }
    filteredArticles = articles.filter(a => 
        a.dieu.toLowerCase().includes(keyword.toLowerCase()) || 
        a.noi_dung.toLowerCase().includes(keyword.toLowerCase())
    );
    currentMatchIndex = 0;
    displayFilteredArticles();
}

function displayFilteredArticles() {
    const container = document.getElementById('results');
    const summary = document.getElementById('summary');
    container.innerHTML = '';
    let currentChapter = '';
    if (filteredArticles.length === 0) {
        summary.innerText = 'Không tìm thấy kết quả.';
        return;
    }
    summary.innerText = `Đã tìm thấy ${filteredArticles.length} kết quả.`;
    filteredArticles.forEach((article, index) => {
        if (article.chuong !== currentChapter) {
            currentChapter = article.chuong;
            container.innerHTML += `<h2>${currentChapter}</h2>`;
        }
        container.innerHTML += `
        <div class="article">
            <h3>${index + 1}. ${highlightKeyword(article.dieu, searchKeyword)}</h3>
            ${formatNoiDung(article.noi_dung, searchKeyword)}
        </div>`;
    });
    matchElements = Array.from(document.querySelectorAll('.highlight'));
    scrollToMatch();
}

function scrollToMatch() {
    if (matchElements.length > 0 && currentMatchIndex >= 0 && currentMatchIndex < matchElements.length) {
        matchElements[currentMatchIndex].scrollIntoView({behavior: 'smooth', block: 'center'});
    }
}

document.getElementById('search-btn').addEventListener('click', search);
document.getElementById('prev-btn').addEventListener('click', () => {
    if (matchElements.length > 0 && currentMatchIndex > 0) {
        currentMatchIndex--;
        scrollToMatch();
    }
});
document.getElementById('next-btn').addEventListener('click', () => {
    if (matchElements.length > 0 && currentMatchIndex < matchElements.length - 1) {
        currentMatchIndex++;
        scrollToMatch();
    }
});
document.getElementById('top-btn').addEventListener('click', () => {
    window.scrollTo({top: 0, behavior: 'smooth'});
});
</script>

</body>
</html>
