
<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tra cứu Bộ luật Tố tụng Hình sự</title>
<style>
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; margin:0; padding:20px; background-color:#f5f5f5;}
#search-container { background:white; padding:20px; border-radius:12px; box-shadow:0 4px 6px rgba(0,0,0,0.1); margin-bottom:20px; display:flex; flex-direction:column; align-items:center;}
#search-box, #chapter-select { width:90%; padding:10px; font-size:18px; border:1px solid #ccc; border-radius:8px; margin-bottom:10px;}
#search-btn { padding:10px 20px; font-size:18px; border:none; background-color:#007aff; color:white; border-radius:8px; cursor:pointer; width:90%;}
#search-btn:hover { background-color:#005bb5;}
#results { margin-top:20px;}
.highlight { background-color:yellow; font-weight:bold;}
.article { background:white; padding:20px; margin-bottom:20px; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.08); text-align:justify; line-height:1.6;}
.article p { text-indent:2em; margin-bottom:10px;}
.article h3 { margin-bottom:15px; }
h2 { color:#007aff; margin-top:30px; }
</style>
</head>
<body>

<div id="search-container">
<select id="chapter-select">
<option value="">Tất cả chương</option>
</select>
<input type="text" id="search-box" placeholder="Nhập từ khóa tìm kiếm...">
<button id="search-btn">Tìm kiếm</button>
</div>

<div id="results"></div>

<script>
let articles = [];
let filteredArticles = [];

fetch('bo_luat_to_tung_hinh_su_full.json')
.then(response => response.json())
.then(data => {
    articles = data;
    loadChapters();
    displayAllArticles();
});

function loadChapters() {
    const chapters = [...new Set(articles.map(a => a.chuong))];
    const select = document.getElementById('chapter-select');
    chapters.forEach(ch => {
        const option = document.createElement('option');
        option.value = ch;
        option.textContent = ch;
        select.appendChild(option);
    });
    select.addEventListener('change', filterByChapter);
}

function highlightKeyword(text, keyword) {
    let regex = new RegExp('(' + keyword + ')', 'gi');
    return text.replace(regex, '<span class="highlight">$1</span>');
}

function formatNoiDung(text) {
    text = text.replace(/(?<!\n)(\d+\.\s)/g, '\n$1');
    text = text.replace(/(?<!\n)([a-z]\))/g, '\n$1');
    const parts = text.trim().split('\n');
    return parts.map(p => `<p>${p.trim()}</p>`).join('\n');
}

function displayAllArticles() {
    const container = document.getElementById('results');
    container.innerHTML = '';
    let currentChapter = '';
    articles.forEach(article => {
        if (article.chuong !== currentChapter) {
            currentChapter = article.chuong;
            container.innerHTML += `<h2>${currentChapter}</h2>`;
        }
        container.innerHTML += `
        <div class="article">
            <h3>${article.dieu}</h3>
            ${formatNoiDung(article.noi_dung)}
        </div>`;
    });
}

function filterByChapter() {
    const selected = document.getElementById('chapter-select').value;
    const keyword = document.getElementById('search-box').value.trim();
    filteredArticles = articles.filter(a => (!selected || a.chuong === selected));
    if (keyword) {
        filteredArticles = filteredArticles.filter(a => 
            a.dieu.toLowerCase().includes(keyword.toLowerCase()) || 
            a.noi_dung.toLowerCase().includes(keyword.toLowerCase())
        );
    }
    displayFilteredArticles();
}

function search() {
    filterByChapter();
}

function displayFilteredArticles() {
    const container = document.getElementById('results');
    container.innerHTML = '';
    let currentChapter = '';
    if (filteredArticles.length === 0) {
        container.innerHTML = '<p>Không tìm thấy kết quả.</p>';
        return;
    }
    filteredArticles.forEach(article => {
        if (article.chuong !== currentChapter) {
            currentChapter = article.chuong;
            container.innerHTML += `<h2>${currentChapter}</h2>`;
        }
        container.innerHTML += `
        <div class="article">
            <h3>${article.dieu}</h3>
            ${formatNoiDung(article.noi_dung)}
        </div>`;
    });
}

document.getElementById('search-btn').addEventListener('click', search);
</script>

</body>
</html>
